"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var forms_1 = require("@angular/forms");
var index_1 = require("../_services/index");
var index_2 = require("../_models/index");
var BuySellSellComponent = (function () {
    function BuySellSellComponent(walletService, buySellService) {
        this.walletService = walletService;
        this.buySellService = buySellService;
        this.operation = "SELL";
        this.currencyTo = 'USD';
        this.sellModel = new index_2.Exchange;
        this.exchangeRateModel = new index_2.ExchangeRate;
        this.messageSuccess = false;
        this.sellForm = new forms_1.FormGroup({
            "wallet_from": new forms_1.FormControl("", forms_1.Validators.required),
            "wallet_to": new forms_1.FormControl("", forms_1.Validators.required),
            "amount": new forms_1.FormControl("", [forms_1.Validators.required, forms_1.Validators.min(0)]),
            "other_amount": new forms_1.FormControl("", forms_1.Validators.min(0)),
            "message": new forms_1.FormControl("")
        });
    }
    BuySellSellComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.walletService.getWallets()
            .subscribe(function (data) {
            _this.wallets = data;
            _this.walletsFrom = _this.wallets.filter(function (wallet) { return wallet.currency != _this.currencyTo; });
            _this.walletsTo = _this.wallets.filter(function (wallet) { return wallet.currency == _this.currencyTo; });
        });
        this.newSellModel();
        this.exchangeRateModel["operation"] = this.operation;
        this.exchangeRateModel["wallet_to_currency"] = this.currencyTo;
    };
    BuySellSellComponent.prototype.newSellModel = function () {
        this.sellModel = this.buySellService.newSellExchangeModel();
    };
    BuySellSellComponent.prototype.getRate = function (wallet_from) {
        var _this = this;
        if (wallet_from) {
            this.exchangeRateModel["wallet_from_currency"] = this.sellModel.wallet_from.currency;
            this.sellModel.amount = 0;
            this.sellModel.other_amount = 0;
            this.buySellService.exchangeRate(this.exchangeRateModel)
                .subscribe(function (data) { _this.sellModel.rate = data; });
        }
    };
    BuySellSellComponent.prototype.amountToUSD = function (amount) {
        if (amount) {
            var other_amount = Number(amount) * this.sellModel.rate;
            this.sellModel.other_amount = Number(other_amount.toFixed(2));
        }
        else {
            this.sellModel.amount = 0;
            this.sellModel.other_amount = 0;
        }
    };
    BuySellSellComponent.prototype.USDtoAmount = function (USD) {
        if (USD) {
            var amount = Number(USD) / this.sellModel.rate;
            this.sellModel.amount = Number(amount.toFixed(8));
        }
        else {
            this.sellModel.amount = 0;
            this.sellModel.other_amount = 0;
        }
    };
    BuySellSellComponent.prototype.sell = function () {
        var _this = this;
        this.messageSuccess = false;
        this.messageError = '';
        this.buySellService.exchange(this.sellModel)
            .subscribe(function (data) {
            _this.messageSuccess = true;
            _this.sellForm.reset();
            _this.newSellModel();
        }, function (error) { _this.messageError = error.detail; });
    };
    BuySellSellComponent = __decorate([
        core_1.Component({
            selector: 'buy-sell-sell',
            templateUrl: './buy-sell-sell.component.html',
            styleUrls: ['./buy-sell-sell.component.css']
        }),
        __metadata("design:paramtypes", [index_1.WalletService,
            index_1.BuySellService])
    ], BuySellSellComponent);
    return BuySellSellComponent;
}());
exports.BuySellSellComponent = BuySellSellComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV5LXNlbGwtc2VsbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJidXktc2VsbC1zZWxsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUEyRTtBQUMzRSx3Q0FBNEU7QUFFNUUsNENBQWdGO0FBQ2hGLDBDQUE4RTtBQVE5RTtJQWFJLDhCQUFxQixhQUE0QixFQUM1QixjQUE4QjtRQUQ5QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFabkQsY0FBUyxHQUFHLE1BQU0sQ0FBQztRQUluQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGNBQVMsR0FBRyxJQUFJLGdCQUFRLENBQUM7UUFFekIsc0JBQWlCLEdBQUcsSUFBSSxvQkFBWSxDQUFDO1FBQ3JDLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBS25CLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxpQkFBUyxDQUFDO1lBQzFCLGFBQWEsRUFBRSxJQUFJLG1CQUFXLENBQUMsRUFBRSxFQUFFLGtCQUFVLENBQUMsUUFBUSxDQUFDO1lBQ3ZELFdBQVcsRUFBRSxJQUFJLG1CQUFXLENBQUMsRUFBRSxFQUFFLGtCQUFVLENBQUMsUUFBUSxDQUFDO1lBQ3JELFFBQVEsRUFBRSxJQUFJLG1CQUFXLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQVUsQ0FBQyxRQUFRLEVBQUUsa0JBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2RSxjQUFjLEVBQUUsSUFBSSxtQkFBVyxDQUFDLEVBQUUsRUFBRSxrQkFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RCxTQUFTLEVBQUUsSUFBSSxtQkFBVyxDQUFDLEVBQUUsQ0FBQztTQUNqQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsdUNBQVEsR0FBUjtRQUFBLGlCQVVDO1FBVEcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVB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O1FBUEcsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQzthQUN2QyxTQUFTLENBQUUsVUFBQSxJQUFJO1lBQU0sS0FBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7WUFDekMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN0QixLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFBQSxDQUFDLEVBQ3pCLFVBQUEsS0FBSyxJQUFNLEtBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUE5RVEsb0JBQW9CO1FBTGhDLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsZUFBZTtZQUN6QixXQUFXLEVBQUUsZ0NBQWdDO1lBQzdDLFNBQVMsRUFBRSxDQUFDLCtCQUErQixDQUFDO1NBQy9DLENBQUM7eUNBY3NDLHFCQUFhO1lBQ1osc0JBQWM7T0FkMUMsb0JBQW9CLENBK0VoQztJQUFELDJCQUFDO0NBQUEsQUEvRUQsSUErRUM7QUEvRVksb0RBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sLCBWYWxpZGF0b3JzfSAgICAgICAgICBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IEJ1eVNlbGxTZXJ2aWNlLCBXYWxsZXRTZXJ2aWNlIH0gICAgICAgICAgICAgIGZyb20gJy4uL19zZXJ2aWNlcy9pbmRleCc7XG5pbXBvcnQgeyBFeGNoYW5nZSwgRXhjaGFuZ2VSYXRlLCBXYWxsZXQgfSAgICAgICAgICAgICBmcm9tICcuLi9fbW9kZWxzL2luZGV4JztcblxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2J1eS1zZWxsLXNlbGwnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9idXktc2VsbC1zZWxsLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9idXktc2VsbC1zZWxsLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBCdXlTZWxsU2VsbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBvcGVyYXRpb24gPSBcIlNFTExcIjtcbiAgICB3YWxsZXRzOiBXYWxsZXRbXTtcbiAgICB3YWxsZXRzRnJvbTogV2FsbGV0W107XG4gICAgd2FsbGV0c1RvOiBXYWxsZXRbXTtcbiAgICBjdXJyZW5jeVRvID0gJ1VTRCc7XG4gICAgc2VsbE1vZGVsID0gbmV3IEV4Y2hhbmdlO1xuICAgIHNlbGxGb3JtOiBGb3JtR3JvdXA7XG4gICAgZXhjaGFuZ2VSYXRlTW9kZWwgPSBuZXcgRXhjaGFuZ2VSYXRlO1xuICAgIG1lc3NhZ2VTdWNjZXNzID0gZmFsc2U7XG4gICAgbWVzc2FnZUVycm9yOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvciggcHJpdmF0ZSB3YWxsZXRTZXJ2aWNlOiBXYWxsZXRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICBwcml2YXRlIGJ1eVNlbGxTZXJ2aWNlOiBCdXlTZWxsU2VydmljZSwgKSB7XG4gICAgICAgIHRoaXMuc2VsbEZvcm0gPSBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgICAgIFwid2FsbGV0X2Zyb21cIjogbmV3IEZvcm1Db250cm9sKFwiXCIsIFZhbGlkYXRvcnMucmVxdWlyZWQpLFxuICAgICAgICAgICAgXCJ3YWxsZXRfdG9cIjogbmV3IEZvcm1Db250cm9sKFwiXCIsIFZhbGlkYXRvcnMucmVxdWlyZWQpLFxuICAgICAgICAgICAgXCJhbW91bnRcIjogbmV3IEZvcm1Db250cm9sKFwiXCIsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1pbigwKV0pLFxuICAgICAgICAgICAgXCJvdGhlcl9hbW91bnRcIjogbmV3IEZvcm1Db250cm9sKFwiXCIsIFZhbGlkYXRvcnMubWluKDApKSxcbiAgICAgICAgICAgIFwibWVzc2FnZVwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIilcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMud2FsbGV0U2VydmljZS5nZXRXYWxsZXRzKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZGF0YSA9PiB7dGhpcy53YWxsZXRzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB0aGlzLndhbGxldHNGcm9tICA9IHRoaXMud2FsbGV0cy5maWx0ZXIod2FsbGV0ID0+IHdhbGxldC5jdXJyZW5jeSAhPSB0aGlzLmN1cnJlbmN5VG8pO1xuICAgICAgICAgICAgICAgIHRoaXMud2FsbGV0c1RvICA9IHRoaXMud2FsbGV0cy5maWx0ZXIod2FsbGV0ID0+IHdhbGxldC5jdXJyZW5jeSA9PSB0aGlzLmN1cnJlbmN5VG8pO1xuXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm5ld1NlbGxNb2RlbCgpO1xuICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZU1vZGVsW1wib3BlcmF0aW9uXCJdID0gdGhpcy5vcGVyYXRpb247XG4gICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlTW9kZWxbXCJ3YWxsZXRfdG9fY3VycmVuY3lcIl0gPSB0aGlzLmN1cnJlbmN5VG87XG4gICAgfVxuXG4gICAgbmV3U2VsbE1vZGVsKCkge1xuICAgICAgICB0aGlzLnNlbGxNb2RlbCA9IHRoaXMuYnV5U2VsbFNlcnZpY2UubmV3U2VsbEV4Y2hhbmdlTW9kZWwoKTtcbiAgICB9XG5cbiAgICBnZXRSYXRlKHdhbGxldF9mcm9tKSB7XG4gICAgICAgIGlmICh3YWxsZXRfZnJvbSkge1xuICAgICAgICAgICAgdGhpcy5leGNoYW5nZVJhdGVNb2RlbFtcIndhbGxldF9mcm9tX2N1cnJlbmN5XCJdID0gdGhpcy5zZWxsTW9kZWwud2FsbGV0X2Zyb20uY3VycmVuY3k7XG4gICAgICAgICAgICB0aGlzLnNlbGxNb2RlbC5hbW91bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5zZWxsTW9kZWwub3RoZXJfYW1vdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuYnV5U2VsbFNlcnZpY2UuZXhjaGFuZ2VSYXRlKHRoaXMuZXhjaGFuZ2VSYXRlTW9kZWwpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShkYXRhID0+IHsgdGhpcy5zZWxsTW9kZWwucmF0ZSA9IGRhdGE7fSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhbW91bnRUb1VTRCAoYW1vdW50KSB7XG4gICAgICAgIGlmIChhbW91bnQpIHtcbiAgICAgICAgICAgIGxldCBvdGhlcl9hbW91bnQgPSBOdW1iZXIoYW1vdW50KSAqIHRoaXMuc2VsbE1vZGVsLnJhdGU7XG4gICAgICAgICAgICB0aGlzLnNlbGxNb2RlbC5vdGhlcl9hbW91bnQgPSBOdW1iZXIob3RoZXJfYW1vdW50LnRvRml4ZWQoMikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxsTW9kZWwuYW1vdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuc2VsbE1vZGVsLm90aGVyX2Ftb3VudCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBVU0R0b0Ftb3VudCAoVVNEKSB7XG4gICAgICAgIGlmIChVU0QpIHtcbiAgICAgICAgICAgIGxldCBhbW91bnQgPSBOdW1iZXIoVVNEKSAvIHRoaXMuc2VsbE1vZGVsLnJhdGU7XG4gICAgICAgICAgICB0aGlzLnNlbGxNb2RlbC5hbW91bnQgPSBOdW1iZXIoYW1vdW50LnRvRml4ZWQoOCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxsTW9kZWwuYW1vdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuc2VsbE1vZGVsLm90aGVyX2Ftb3VudCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZWxsKCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVzc2FnZUVycm9yID0gJyc7XG4gICAgICAgIHRoaXMuYnV5U2VsbFNlcnZpY2UuZXhjaGFuZ2UodGhpcy5zZWxsTW9kZWwpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCBkYXRhID0+IHsgdGhpcy5tZXNzYWdlU3VjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsbEZvcm0ucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXdTZWxsTW9kZWwoKTt9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHsgdGhpcy5tZXNzYWdlRXJyb3IgPSBlcnJvci5kZXRhaWw7fSk7XG4gICAgfVxufVxuIl19