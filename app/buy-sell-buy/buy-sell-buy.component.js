"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var forms_1 = require("@angular/forms");
var index_1 = require("../_services/index");
var index_2 = require("../_models/index");
var BuySellBuyComponent = (function () {
    function BuySellBuyComponent(buySellService, walletService) {
        this.buySellService = buySellService;
        this.walletService = walletService;
        this.operation = "BUY";
        this.currencyFrom = 'USD';
        this.buyModel = new index_2.Exchange;
        this.exchangeRateModel = new index_2.ExchangeRate;
        this.messageSuccess = false;
        this.buyForm = new forms_1.FormGroup({
            "wallet_from": new forms_1.FormControl("", forms_1.Validators.required),
            "wallet_to": new forms_1.FormControl("", forms_1.Validators.required),
            "amount": new forms_1.FormControl("", [forms_1.Validators.required, forms_1.Validators.min(0)]),
            "other_amount": new forms_1.FormControl("", forms_1.Validators.min(0)),
            "message": new forms_1.FormControl("")
        });
    }
    BuySellBuyComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.walletService.getWallets()
            .subscribe(function (data) {
            _this.wallets = data;
            _this.walletsFrom = _this.wallets.filter(function (wallet) { return wallet.currency == _this.currencyFrom; });
            _this.walletsTo = _this.wallets.filter(function (wallet) { return wallet.currency != _this.currencyFrom; });
        });
        this.newBuyModel();
        this.exchangeRateModel["operation"] = this.operation;
        this.exchangeRateModel["wallet_from_currency"] = this.currencyFrom;
    };
    BuySellBuyComponent.prototype.newBuyModel = function () {
        this.buyModel = this.buySellService.newBuyExchangeModel();
    };
    BuySellBuyComponent.prototype.getRate = function (wallet_to) {
        var _this = this;
        if (wallet_to) {
            this.exchangeRateModel["wallet_to_currency"] = wallet_to.currency;
            this.buyModel.amount = 0;
            this.buyModel.other_amount = 0;
            this.buySellService.exchangeRate(this.exchangeRateModel)
                .subscribe(function (data) { _this.buyModel.rate = data; });
        }
    };
    BuySellBuyComponent.prototype.amountToUSD = function (amount) {
        if (amount) {
            var other_amount = Number(amount) * this.buyModel.rate;
            this.buyModel.other_amount = Number(other_amount.toFixed(2));
        }
        else {
            this.buyModel.amount = 0;
            this.buyModel.other_amount = 0;
        }
    };
    BuySellBuyComponent.prototype.USDtoAmount = function (USD) {
        if (USD) {
            var amount = Number(USD) / this.buyModel.rate;
            this.buyModel.amount = Number(amount.toFixed(8));
        }
        else {
            this.buyModel.amount = 0;
            this.buyModel.other_amount = 0;
        }
    };
    BuySellBuyComponent.prototype.buy = function () {
        var _this = this;
        this.messageSuccess = false;
        this.messageError = '';
        this.buySellService.exchange(this.buyModel)
            .subscribe(function (data) {
            _this.messageSuccess = true;
            _this.buyForm.reset();
            _this.newBuyModel();
        }, function (error) { _this.messageError = error.detail; });
    };
    BuySellBuyComponent = __decorate([
        core_1.Component({
            selector: 'buy-sell-buy',
            templateUrl: './buy-sell-buy.component.html',
            styleUrls: ['./buy-sell-buy.component.css']
        }),
        __metadata("design:paramtypes", [index_1.BuySellService,
            index_1.WalletService])
    ], BuySellBuyComponent);
    return BuySellBuyComponent;
}());
exports.BuySellBuyComponent = BuySellBuyComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV5LXNlbGwtYnV5LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJ1eS1zZWxsLWJ1eS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkU7QUFDM0Usd0NBQTRFO0FBRTVFLDRDQUFnRjtBQUNoRiwwQ0FBOEU7QUFROUU7SUFhSSw2QkFBcUIsY0FBOEIsRUFDOUIsYUFBNEI7UUFENUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBWmpELGNBQVMsR0FBRyxLQUFLLENBQUM7UUFJbEIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDckIsYUFBUSxHQUFHLElBQUksZ0JBQVEsQ0FBQztRQUV4QixzQkFBaUIsR0FBRyxJQUFJLG9CQUFZLENBQUM7UUFDckMsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFLbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLGlCQUFTLENBQUM7WUFDekIsYUFBYSxFQUFFLElBQUksbUJBQVcsQ0FBQyxFQUFFLEVBQUUsa0JBQVUsQ0FBQyxRQUFRLENBQUM7WUFDdkQsV0FBVyxFQUFFLElBQUksbUJBQVcsQ0FBQyxFQUFFLEVBQUUsa0JBQVUsQ0FBQyxRQUFRLENBQUM7WUFDckQsUUFBUSxFQUFFLElBQUksbUJBQVcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBVSxDQUFDLFFBQVEsRUFBRSxrQkFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZFLGNBQWMsRUFBRSxJQUFJLG1CQUFXLENBQUMsRUFBRSxFQUFFLGtCQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RELFNBQVMsRUFBRSxJQUFJLG1CQUFXLENBQUMsRUFBRSxDQUFDO1NBQ2pDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxzQ0FBUSxHQUFSO1FBQUEsaUJBU0M7UUFSRyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRTthQUMxQixTQUFTLENBQUMsVUFBQSxJQUFJO1lBQUssS0FBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDcEMsS0FBSSxDQUFDLFdBQVcsR0FBSSxLQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxRQUFRLElBQUksS0FBSSxDQUFDLFlBQVksRUFBcEMsQ0FBb0MsQ0FBQyxDQUFDO1lBQ3hGLEtBQUksQ0FBQyxTQUFTLEdBQUksS0FBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBQSxNQUFNLElBQUksT0FBQSxNQUFNLENBQUMsUUFBUSxJQUFJLEtBQUksQ0FBQyxZQUFZLEVBQXBDLENBQW9DLENBQUMsQ0FBQztRQUMxRixDQUFDLENBQUMsQ0FBQztRQUNQLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUNyRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsc0JBQXNCLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQ3ZFLENBQUM7SUFFRCx5Q0FBVyxHQUFYO1FBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDOUQsQ0FBQztJQUVELHFDQUFPLEdBQVAsVUFBUSxTQUFTO1FBQWpCLGlCQVFDO1FBUEcsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNaLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUM7WUFDbEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUM7aUJBQ25ELFNBQVMsQ0FBQyxVQUFBLElBQUksSUFBTSxLQUFJLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQztRQUMxRCxDQUFDO0lBQ0wsQ0FBQztJQUVELHlDQUFXLEdBQVgsVUFBYSxNQUFNO1FBQ2YsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNULElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztZQUN2RCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7UUFDbkMsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBVyxHQUFYLFVBQWEsR0FBRztRQUNaLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDTixJQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDekIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLENBQUM7SUFDTCxDQUFDO0lBRUQsaUNBQUcsR0FBSDtRQUFBLGlCQVFDO1FBUEcsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQzthQUN0QyxTQUFTLENBQUUsVUFBQSxJQUFJO1lBQU0sS0FBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7WUFDekMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNyQixLQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFBQSxDQUFDLEVBQ3hCLFVBQUEsS0FBSyxJQUFNLEtBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUE3RVEsbUJBQW1CO1FBTC9CLGdCQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsY0FBYztZQUN4QixXQUFXLEVBQUUsK0JBQStCO1lBQzVDLFNBQVMsRUFBRSxDQUFDLDhCQUE4QixDQUFDO1NBQzlDLENBQUM7eUNBY3VDLHNCQUFjO1lBQ2YscUJBQWE7T0FkeEMsbUJBQW1CLENBOEUvQjtJQUFELDBCQUFDO0NBQUEsQUE5RUQsSUE4RUM7QUE5RVksa0RBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sLCBWYWxpZGF0b3JzfSAgICAgICAgICBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IEJ1eVNlbGxTZXJ2aWNlLCBXYWxsZXRTZXJ2aWNlIH0gICAgICAgICAgICAgIGZyb20gJy4uL19zZXJ2aWNlcy9pbmRleCc7XG5pbXBvcnQgeyBFeGNoYW5nZSwgRXhjaGFuZ2VSYXRlLCBXYWxsZXQgfSAgICAgICAgICAgICBmcm9tICcuLi9fbW9kZWxzL2luZGV4JztcblxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2J1eS1zZWxsLWJ1eScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2J1eS1zZWxsLWJ1eS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vYnV5LXNlbGwtYnV5LmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBCdXlTZWxsQnV5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIG9wZXJhdGlvbiA9IFwiQlVZXCI7XG4gICAgd2FsbGV0czogV2FsbGV0W107XG4gICAgd2FsbGV0c0Zyb206IFdhbGxldFtdO1xuICAgIHdhbGxldHNUbzogV2FsbGV0W107XG4gICAgY3VycmVuY3lGcm9tID0gJ1VTRCc7XG4gICAgYnV5TW9kZWwgPSBuZXcgRXhjaGFuZ2U7XG4gICAgYnV5Rm9ybTogRm9ybUdyb3VwO1xuICAgIGV4Y2hhbmdlUmF0ZU1vZGVsID0gbmV3IEV4Y2hhbmdlUmF0ZTtcbiAgICBtZXNzYWdlU3VjY2VzcyA9IGZhbHNlO1xuICAgIG1lc3NhZ2VFcnJvcjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoIHByaXZhdGUgYnV5U2VsbFNlcnZpY2U6IEJ1eVNlbGxTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICBwcml2YXRlIHdhbGxldFNlcnZpY2U6IFdhbGxldFNlcnZpY2UsKSB7XG4gICAgICAgIHRoaXMuYnV5Rm9ybSA9IG5ldyBGb3JtR3JvdXAoe1xuICAgICAgICAgICAgXCJ3YWxsZXRfZnJvbVwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgVmFsaWRhdG9ycy5yZXF1aXJlZCksXG4gICAgICAgICAgICBcIndhbGxldF90b1wiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgVmFsaWRhdG9ycy5yZXF1aXJlZCksXG4gICAgICAgICAgICBcImFtb3VudFwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluKDApXSksXG4gICAgICAgICAgICBcIm90aGVyX2Ftb3VudFwiOiBuZXcgRm9ybUNvbnRyb2woXCJcIiwgVmFsaWRhdG9ycy5taW4oMCkpLFxuICAgICAgICAgICAgXCJtZXNzYWdlXCI6IG5ldyBGb3JtQ29udHJvbChcIlwiKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy53YWxsZXRTZXJ2aWNlLmdldFdhbGxldHMoKVxuICAgICAgICAgICAgLnN1YnNjcmliZShkYXRhID0+IHt0aGlzLndhbGxldHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHRoaXMud2FsbGV0c0Zyb20gID0gdGhpcy53YWxsZXRzLmZpbHRlcih3YWxsZXQgPT4gd2FsbGV0LmN1cnJlbmN5ID09IHRoaXMuY3VycmVuY3lGcm9tKTtcbiAgICAgICAgICAgICAgICB0aGlzLndhbGxldHNUbyAgPSB0aGlzLndhbGxldHMuZmlsdGVyKHdhbGxldCA9PiB3YWxsZXQuY3VycmVuY3kgIT0gdGhpcy5jdXJyZW5jeUZyb20pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubmV3QnV5TW9kZWwoKTtcbiAgICAgICAgdGhpcy5leGNoYW5nZVJhdGVNb2RlbFtcIm9wZXJhdGlvblwiXSA9IHRoaXMub3BlcmF0aW9uO1xuICAgICAgICB0aGlzLmV4Y2hhbmdlUmF0ZU1vZGVsW1wid2FsbGV0X2Zyb21fY3VycmVuY3lcIl0gPSB0aGlzLmN1cnJlbmN5RnJvbTtcbiAgICB9XG5cbiAgICBuZXdCdXlNb2RlbCgpIHtcbiAgICAgICAgdGhpcy5idXlNb2RlbCA9IHRoaXMuYnV5U2VsbFNlcnZpY2UubmV3QnV5RXhjaGFuZ2VNb2RlbCgpO1xuICAgIH1cblxuICAgIGdldFJhdGUod2FsbGV0X3RvKSB7XG4gICAgICAgIGlmICh3YWxsZXRfdG8pIHtcbiAgICAgICAgICAgIHRoaXMuZXhjaGFuZ2VSYXRlTW9kZWxbXCJ3YWxsZXRfdG9fY3VycmVuY3lcIl0gPSB3YWxsZXRfdG8uY3VycmVuY3k7XG4gICAgICAgICAgICB0aGlzLmJ1eU1vZGVsLmFtb3VudCA9IDA7XG4gICAgICAgICAgICB0aGlzLmJ1eU1vZGVsLm90aGVyX2Ftb3VudCA9IDA7XG4gICAgICAgICAgICB0aGlzLmJ1eVNlbGxTZXJ2aWNlLmV4Y2hhbmdlUmF0ZSh0aGlzLmV4Y2hhbmdlUmF0ZU1vZGVsKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZGF0YSA9PiB7IHRoaXMuYnV5TW9kZWwucmF0ZSA9IGRhdGE7fSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhbW91bnRUb1VTRCAoYW1vdW50KSB7XG4gICAgICAgIGlmIChhbW91bnQpIHtcbiAgICAgICAgICAgIGxldCBvdGhlcl9hbW91bnQgPSBOdW1iZXIoYW1vdW50KSAqIHRoaXMuYnV5TW9kZWwucmF0ZTtcbiAgICAgICAgICAgIHRoaXMuYnV5TW9kZWwub3RoZXJfYW1vdW50ID0gTnVtYmVyKG90aGVyX2Ftb3VudC50b0ZpeGVkKDIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYnV5TW9kZWwuYW1vdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuYnV5TW9kZWwub3RoZXJfYW1vdW50ID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIFVTRHRvQW1vdW50IChVU0QpIHtcbiAgICAgICAgaWYgKFVTRCkge1xuICAgICAgICAgICAgbGV0IGFtb3VudCA9IE51bWJlcihVU0QpIC8gdGhpcy5idXlNb2RlbC5yYXRlO1xuICAgICAgICAgICAgdGhpcy5idXlNb2RlbC5hbW91bnQgPSBOdW1iZXIoYW1vdW50LnRvRml4ZWQoOCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5idXlNb2RlbC5hbW91bnQgPSAwO1xuICAgICAgICAgICAgdGhpcy5idXlNb2RlbC5vdGhlcl9hbW91bnQgPSAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYnV5KCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVzc2FnZUVycm9yID0gJyc7XG4gICAgICAgIHRoaXMuYnV5U2VsbFNlcnZpY2UuZXhjaGFuZ2UodGhpcy5idXlNb2RlbClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoIGRhdGEgPT4geyB0aGlzLm1lc3NhZ2VTdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idXlGb3JtLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV3QnV5TW9kZWwoKTt9LFxuICAgICAgICAgICAgICAgIGVycm9yID0+IHsgdGhpcy5tZXNzYWdlRXJyb3IgPSBlcnJvci5kZXRhaWw7fSk7XG4gICAgfVxufVxuIl19